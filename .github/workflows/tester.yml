name: Test Terraform Installer

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        os: [ubuntu, debian, fedora]
    container:
      image: ${{ matrix.os }}:latest  # Pulls the latest version of each OS

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install dependencies (Debian-based)
        if: contains(matrix.os, 'ubuntu') || contains(matrix.os, 'debian')
        run: apt-get update && apt-get install -y wget gpg sudo

      - name: Install dependencies (Fedora)
        if: contains(matrix.os, 'fedora')
        run: dnf install -y wget gnupg sudo

      - name: Run the Terraform installer script
        run: sh ./terraform-installer.sh  # No sudo needed

      - name: Verify Terraform installation
        run: terraform --version
